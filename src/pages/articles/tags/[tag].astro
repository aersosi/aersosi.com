---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/lib/elements/Text.astro";
import Wrapper from "@/components/lib/containers/Wrapper.astro";
import ArticlesEntry from "@/components/lib/entries/ArticlesEntry.astro";
import { getCollection } from "astro:content";
import Link from "@/components/lib/elements/Link.astro";
import { stackGrid, stackGridPadding } from "@/shared/classes";

export async function getStaticPaths() {
  const allPosts = await getCollection("articles");
  const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];
  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.data.tags.includes(tag));
    return {
      params: { tag },
      props: { articles: filteredPosts },
    };
  });
}
const { tag } = Astro.params;
const { articles } = Astro.props;

const allPostsUnsorted = await getCollection("articles");
const allPosts = allPostsUnsorted.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const tags = [...new Set(allPosts.map((post) => post.data.tags).flat())];
---

<BaseLayout
  pageTitle={`Artikel Kategorie | ${tag} | Arthur Ersosi`}
  pageDescription={`Artikel zum Thema ${tag} von Arthur Ersosi. Lesen Sie Tipps und Erfahrungen zu Frontend-Entwicklung, UI/UX-Design und Web-Technologien.`}
>
  <section>
    <Wrapper variant="standard">
      <div class:list={[...stackGrid, ...stackGridPadding]}>
        <div class="grid gap-4">
          <Text tag="h1" variant="text2XL" class="capitalize">
            {tag}
          </Text>

          <div class="grid gap-2">
            <Text tag="h2" variant="textBase" class="flex justify-baseline gap-1">
              Alle Kategorien
              <span class="flex gap-0.5">
                (<Link
                  href="/articles/tags"
                  size="base"
                  variant="primary"
                  aria-label="Index aller Kategorien"
                  data-a11ytip-bottom>Index</Link
                >)
              </span>
            </Text>

            <div class="scrollable-content scrollbar-hide snap-x snap-proximity overflow-x-scroll">
              <div class="flex gap-x-4 gap-y-1 lg:flex-col">
                {
                  tags.map((tag) => (
                    <Link href={`/articles/tags/${tag}`} size="sm" variant="primary">
                      {tag}
                    </Link>
                  ))
                }
              </div>
            </div>
          </div>
        </div>
        <div class="flex flex-col gap-12 lg:col-span-2">
          {articles.map((post) => <ArticlesEntry post={post} />)}
        </div>
      </div>
    </Wrapper>
  </section>
</BaseLayout>
