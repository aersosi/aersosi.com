---
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/lib/elements/Text.astro";
import Wrapper from "@/components/lib/containers/Wrapper.astro";
// Components
import BlogEntry from "@/components/blog/BlogEntry.astro";
// Content
const {frontmatter} = Astro.props;
// Get all posts and filter by tag
import { getCollection } from "astro:content";
import GoBack from "@/components/lib/elements/GoBack.astro";
import Button from "@/components/lib/elements/Button.astro";
const allPosts = await getCollection("posts");
const relatedPosts = allPosts.filter((post) =>
    post.data.tags.some((tag) => frontmatter.tags.includes(tag))
);
---

<BaseLayout>
    <section>
        <Wrapper variant="standard">
            <div class="grid grid-cols-1 gap-x-12 gap-y-8 lg:grid-cols-3  pb-16 pt-24 lg:pt-40 border-b border-base-400 dark:border-base-600">
                <div class="lg:sticky lg:top-16 lg:z-40 self-start text-balance">
                    <div class="flex gap-8 flex-col">
                        <GoBack/>

                        <Text tag="h1" variant="textLG" class="font-medium text-base-900 dark:text-white">
                            {frontmatter.title}
                        </Text>
                        <Text tag="p" variant="textSM" class="text-base-600 dark:text-base-300">
                            {frontmatter.description}
                        </Text>
                        <slot name="extra"/>
                    </div>
                </div>
                <div class="lg:col-span-2">
                    <Image
                            width={1000}
                            height={800}
                            loading="eager"
                            decoding="async"
                            alt={frontmatter.image.alt}
                            src={frontmatter.image.url}
                            class="object-cover object-center w-full aspect-12/6 lg:col-span-2 rounded-xl"
                    />
                    <Wrapper variant="prose" class="mt-4">
                        <slot/>
                    </Wrapper>
                </div>
            </div>
        </Wrapper>
    </section>
    {
        relatedPosts.length > 0 && (
                    <section>
                        <Wrapper variant="standard">
                            <div class="grid grid-cols-1 gap-x-12 gap-y-8 lg:gap-4 lg:grid-cols-3 py-24">
                                <Text
                                        tag="h2"
                                        variant="textBase"
                                        class="text-base-900 dark:text-white "
                                >
                                    Related posts
                                </Text>
                                <div class="flex flex-col gap-12 lg:col-span-2">
                                    {relatedPosts.slice(0, 3).map((post) => (
                                            <BlogEntry post={post}/>
                                    ))}
                                </div>
                            </div>
                        </Wrapper>
                    </section>
        )
    }
</BaseLayout>
