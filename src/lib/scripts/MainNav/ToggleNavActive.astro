<script>
  import { normalizePath } from "../normalizePath";

  function updateActiveNav() {
    const hash = window.location.hash;
    const currentUrl = normalizePath(window.location.pathname) + hash;

    document.querySelectorAll(".nav-link").forEach((navLink) => {
      let linkHref;

      if (navLink.hasAttribute("href")) {
        linkHref = normalizePath(navLink.getAttribute("href"));
      } else {
        const linkElement = navLink.querySelector("a[href]") || navLink.querySelector("[href]");
        if (linkElement) {
          linkHref = normalizePath(linkElement.getAttribute("href"));
        } else {
          return;
        }
      }

      const isActive =
        linkHref === currentUrl || linkHref === normalizePath(window.location.pathname) || linkHref === hash;

      const inactiveButton = navLink.querySelector(".inactive");
      const activeButton = navLink.querySelector(".active");

      if (inactiveButton && activeButton) {
        inactiveButton.classList.toggle("hidden", isActive);
        activeButton.classList.toggle("hidden", !isActive);
      }
    });
  }

  updateActiveNav();
  window.addEventListener("hashchange", updateActiveNav);
  window.addEventListener("popstate", updateActiveNav);
</script>
