<script>
  import { debounce } from "../debounce";
  import { throttle } from "../throttle";

  function updateReadingProgress() {
    const progressBar = document.getElementById("readingProgress");
    if (!progressBar) return;

    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = Math.min(Math.max((scrollTop / docHeight) * 100, 0), 100);

    progressBar.style.width = `${progress}%`;
  }

  const excludedExactPaths = ["/", "/404", "/articles", "/projects", "/articles/", "/projects/"];
  const excludedSubPaths = ["/articles/tags", "/projects/tags"];
  const currentPath = window.location.pathname;

  const isExcluded =
    excludedExactPaths.includes(currentPath) || excludedSubPaths.some((path) => currentPath.startsWith(path));

  const throttledUpdateProgress = throttle(updateReadingProgress, 50);

  if (!isExcluded) {
    updateReadingProgress();
    window.addEventListener("scroll", throttledUpdateProgress);
    window.addEventListener("resize", throttledUpdateProgress);
  }
</script>
